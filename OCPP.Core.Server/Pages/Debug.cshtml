@page
@model OCPP.Core.Server.Pages.DebugModel
@{
    ViewData["Title"] = "Debuger";
}

@{
    Layout = "Shared/_Layout";
}
@using Microsoft.AspNetCore.Components
@using System.Globalization;
@using OCPP.Core.Database
@using OCPP.Core.Server


<main class="main-content position-relative border-radius-lg ps">

    <div class="card ">
        <div class="card-header pb-0 p-3">
            <div class="d-flex justify-content-between">
                <h6 class="mb-2">System's Chargers</h6>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table align-items-center ">
                @foreach (ConnectorStatusView cpvm in Model.connectorStatus)
                {
                    string chargePointName = string.IsNullOrWhiteSpace(cpvm.ConnectorName) ? $"{cpvm.ChargePointId}:{cpvm.ConnectorId}" : cpvm.ConnectorName;
                    string lastCharge = (cpvm.MeterStart >= 0 && cpvm.MeterStop != null) ? string.Format("ChargekWh", (cpvm.MeterStop - cpvm.MeterStart)) : null;
                    string chargeTime = null;
                    if (cpvm.StartTime != null && cpvm.StopTime == null)
                    {
                        TimeSpan timeSpan = DateTime.UtcNow.Subtract(cpvm.StartTime.Value);
                        chargeTime = string.Format("ChargeTime", (timeSpan.Days * 24 + timeSpan.Hours), timeSpan.Minutes);
                    }

                    string cpIcon = "fa-plug";
                    string cpColor = "successColor";
                    string cpTitle = "Available";
                    switch (cpvm.LastStatus)
                    {
                        case "Charging":
                            cpIcon = "fa-bolt"; //"fa-car";
                            cpColor = "errorColor";
                            cpTitle = "Charging";
                            break;
                        case "Faulted":
                            cpIcon = "fa-times-circle";
                            cpColor = "errorColor";
                            cpTitle = "Faulted";
                            break;
                        case "Unavailable":
                            cpIcon = "fa-ban";
                            cpColor = "unavailableColor";
                            cpTitle = "Unavailable";
                            break;
                    }
                    <tr>
                        <td class="w-30">
                            <div class="d-flex px-2 py-1 align-items-center">
                                <div>
                                    <div><i class="fas fa-unlink" title="ChargePointOnline"></i></div>
                                    @*                                            @if (cpvm.Online)
                                        {
                                        <div><i class="fas fa-link" title="@Localizer["ChargePointOnline"]"></i></div>
                                        }
                                        else
                                        {
                                        <div><i class="fas fa-unlink" title="@Localizer["ChargePointOffline"]"></i></div>
                                        }*@
                                </div>
                                <div class="ms-4">
                                    <p class="text-xs font-weight-bold mb-0">Name:</p>
                                    <h6 class="text-sm mb-0">@chargePointName</h6>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="text-center">
                                <p class="text-xs font-weight-bold mb-0">Status:</p>
                                @*<a href="~/Home/Transactions/@Uri.EscapeDataString(cpvm.ChargePointId)/@cpvm.ConnectorId" class="text-decoration-none">*@
                                <h6 class="text-sm mb-0">@cpTitle</h6>
                            </div>
                        </td>
                        <td>
                            <div class="text-center">

                                @if (!string.IsNullOrEmpty(chargeTime))
                                {
                                    <p class="text-xs font-weight-bold mb-0">Value Metered:</p>
                                    <h6 class="text-sm mb-0">
                                        <p class="card-text">@chargeTime</p>
                                    </h6>
                                }
                                else if (!string.IsNullOrEmpty(lastCharge))
                                {
                                    <p class="text-xs font-weight-bold mb-0">Last Charge:</p>
                                    <h6 class="text-sm mb-0">
                                        <p class="card-text">@lastCharge</p>
                                    </h6>
                                }

                            </div>
                        </td>
                        @*                                @if (Model.ServerConnection)
                            {
                            <td class="align-middle text-sm">
                            <div class="col text-center">
                            <p class="text-xs font-weight-bold mb-0">Charging Data:</p>
                            <h6 class="text-sm mb-0">@cpvm.CurrentChargeData</h6>
                            </div>
                            </td>
                            }*@
                    </tr>
                }
            </table>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-lg-2 col-md-4">
            <div class="card">
                <div class="card-header pb-0 p-3">
                    <h6 class="mb-0">Server Actions</h6>
                </div>
                <div class="card-body p-3">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3  text-center">
                                    <i class="fa-solid fa-check" style="color:#52FF47"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-dark text-sm">Make Operative</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.11</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-bs-parent="#accordionRental" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3  text-center">
                                    <i class="fa-solid fa-xmark" style="color:#C70039"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-dark text-sm">Make Inoperative</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.11</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-bs-parent="#accordionRental" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3  text-center">
                                    <i class="fa-solid fa-bolt" style="color:#FFD226"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-play text-sm">Remote Start Transaction</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.11</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-bs-parent="#accordionRental" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3 text-center">
                                    <i class="fa-solid fa-pause" style="color:#C70039"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-dark text-sm">Remote Stop Transaction</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.12</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionRentalTwo" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3 text-center">
                                    <i class="fa-solid fa-comment"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-dark text-sm">Request Status Notification</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.12</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionRentalTwo" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item px-0 d-flex pb-4" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseOne">
                            <div class="d-flex align-items-center">
                                <div class="me-3 text-center">
                                    <i class="fa-solid fa-brain" style="color:#FF9847"></i>
                                </div>
                                <div class="d-flex flex-column">
                                    <h6 class="mb-1 text-dark text-sm">Set Charging Profile</h6>
                                    <span class="text-xs">OCPP 1.6 - 5.12</span>
                                </div>
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionRentalTwo" style="">
                                <div class="d-flex">
                                    <input class="form-control" type="text" value="Tag id" id="example-text-input">
                                    <button class="btn btn-link btn-icon-only btn-rounded btn-sm text-dark icon-move-right my-auto" type="submit"><i class="ni ni-bold-right" aria-hidden="true"></i></button>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-lg-10 col-md-8 mt-sm-8 mt-lg-0 mt-md-0">

            <div class="card max-height-vh-80">
                <div class="card-header pb-0">
                    <h6>OCPP Transactions Timeline</h6>
                </div>
                <div class="card-body p-3 overflow-auto" id="scrollDiv">
                    <div class="timeline timeline-one-side" data-timeline-axis-style="dotted" id="timelineContent">
                    </div>
                </div>
            </div>
        </div>
    </div>
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMsg))
    {
        <br />
        <div class="alert alert-danger" role="alert">
            @ViewBag.ErrorMsg
        </div>
    }
</main>
